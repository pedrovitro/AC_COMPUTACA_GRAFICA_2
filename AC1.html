<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>AC 1 Keyboard</title>

    <!-- Babylon.js -->
    <script src="https://code.jquery.com/pep/0.4.2/pep.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <script src="https://preview.babylonjs.com/ammo.js"></script>
    <script src="https://preview.babylonjs.com/cannon.js"></script>
    <script src="https://preview.babylonjs.com/Oimo.js"></script>
    <script src="https://preview.babylonjs.com/earcut.min.js"></script>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
    <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
    <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>

<body>
    <canvas id="renderCanvas"></canvas>
    <script>

//ITENS FALTANTES
//colcoar as texturas tanto nas notas como no pad em cima
//fazer os sustenidos 
//achar os sons das teclas, substituir os que estao aqui ja 
//resolver bug na tecla que abaixa quando aperta em uma sustenido

        var canvas = document.getElementById("renderCanvas");

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function () { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true, disableWebGL2Support: false }); };
        var scene;
        var notes = new Map();

        var createScene = function () {
            scene = new BABYLON.Scene(engine);

            /**** Set camera and light *****/
            const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 10, new BABYLON.Vector3(0, 0, 0));
            camera.attachControl(canvas, true);
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0));

            //const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 10, height: 10 });
           // ground.isPickable = false;

            managerEvents();


            //CRIAR BASE E APLICAR TEXTURA
            var base = BABYLON.MeshBuilder.CreateBox("base",{height: 1, width: 10, depth:5}, scene);
            base.position.x = -0.5;
            base.position.z = 3.75;

            //CRIAR AS NOTAS
            //PRIMEIRA OITAVA
            noteDo1 = new Note("do1", "316899__jaz-the-man-2__do-stretched.wav", scene);
            noteDo1.box.position.x = -4.5;


           
            noteRe1 = new Note("re1", "316900__jaz-the-man-2__do-stretched-octave.wav");
            noteRe1.box.position.x = -4;

            noteMi1 = new Note("mi1", "/assets/re.wav");
            noteMi1.box.position.x = -3.5;

            noteFa1 = new Note("fa1", "/assets/re.wav");
            noteFa1.box.position.x = -3;

            noteSol1 = new Note("sol1", "/assets/re.wav");
            noteSol1.box.position.x = -2.5;

            noteLa1 = new Note("la1", "/assets/re.wav");
            noteLa1.box.position.x = -2;

            noteSi1 = new Note("si1", "/assets/re.wav");
            noteSi1.box.position.x = -1.5;


             //SEGUNDA OITAVA
            noteDo2 = new Note("do2", "316899__jaz-the-man-2__do-stretched.wav", scene);
            noteDo2.box.position.x = -1;

           
            noteRe2 = new Note("re2", "316900__jaz-the-man-2__do-stretched-octave.wav");
            noteRe2.box.position.x = -0.5;

            noteMi2 = new Note("mi2", "/assets/re.wav");
            noteMi2.box.position.x = 0;

            noteFa2 = new Note("fa2", "/assets/re.wav");
            noteFa2.box.position.x = 0.5;

            noteSol2 = new Note("sol2", "/assets/re.wav");
            noteSol2.box.position.x = 1;

            noteLa2 = new Note("la2", "/assets/re.wav");
            noteLa2.box.position.x = 1.5;

            noteSi2 = new Note("si2", "/assets/re.wav");
            noteSi2.box.position.x = 2;

            //SUSTENIDOS
            noteDoS1 = new Note("dos1", "/assets/do.wav");
            noteDoS1.box1.position.y = 0.5;
            noteDoS1.box1.position.x = -4.25;
            noteDoS1.box1.position.z = -0.25;






            notes.set("do1",noteDo1);
            notes.set("re1",noteRe1);
            notes.set("mi1",noteMi1);
            notes.set("fa1",noteFa1);
            notes.set("sol1",noteSol1);
            notes.set("la1",noteLa1);
            notes.set("si1",noteSi1);

            notes.set("do2",noteDo2);
            notes.set("re2",noteRe2);
            notes.set("mi2",noteMi2);
            notes.set("fa2",noteFa2);
            notes.set("sol2",noteSol2);
            notes.set("la2",noteLa2);
            notes.set("si2",noteSi2);

            notes.set("dos1",noteDoS1);

            return scene;
        };

        function managerEvents() {

            scene.onPointerDown = function (evt, pickResults) {
                if (pickResults.hit) {
                    notes.get(pickResults.pickedMesh.name).play();
                }
            }

        }

        initFunction = async function () {
            var asyncEngineCreation = async function () {
                try {
                    return createDefaultEngine();
                } catch (e) {
                    console.log("the available createEngine function failed. Creating the default engine instead");
                    return createDefaultEngine();
                }
            }

            engine = await asyncEngineCreation();
            if (!engine) throw 'engine should not be null.';
            scene = createScene();
        };
        initFunction().then(() => {
            sceneToRender = scene
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });


        class Note {
            constructor(noteName, noteUrl) {
                this.ySlide = new BABYLON.Animation("ySlide", "position.y", 100, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);
                let keyFrames = [];

                keyFrames.push({
                    frame: 0,
                    value: 0
                });

                keyFrames.push({
                    frame: 5,
                    value: -0.5
                });

                keyFrames.push({
                    frame: 10,
                    value: 0
                });

                this.ySlide.setKeys(keyFrames);

                var whiteMaterial = new BABYLON.StandardMaterial("myWhiteMaterial", scene);
                whiteMaterial.diffuseColor = new BABYLON.Color3(0,1,1);
                var blackMaterial = new BABYLON.StandardMaterial("myBlackMaterial", scene);
                blackMaterial.diffuseColor = new BABYLON.Color3(0,0,0);

                // Load the sound, give it time to load and play it every 3 seconds
                this.note = new BABYLON.Sound(noteName, noteUrl, scene);
               
                this.box = BABYLON.MeshBuilder.CreateBox(noteName,{height: 1, width: 0.5, depth: 2.5}, scene);
                this.box.material = whiteMaterial;

                this.box1 = BABYLON.MeshBuilder.CreateBox(noteName,{height: 0.5, width: 0.5, depth:1.5}, scene);
                this.box1.material = blackMaterial;
            }

            play() {
                this.note.play();
                scene.beginDirectAnimation(this.box, [this.ySlide], 0, 10, true);
            }
        }
    </script>
</body>

</html>